{% extends "template.html" %}

{% block title %}New Sample: Collection and Consent Information{% endblock %}

{% block body %}
    <div class="container">
        
        <h1><span class="secondary-heading"><i class="fas fa-vial"></i> New Sample</span> Collection and Consent Information</h1>
        {{ render_progress(1, 7) }}


        {% if form.form_select.choices|length > 0 and template_count > 0%}

            <p>Before we continue, you must first link the sample to a patient consent form.</p>

            <p>If you are unable to find the patient consent form, it's likely that you have yet to add it. <a href="{{ url_for('consent.new') }}">Click here</a> to add a new patient consent form.</p>

            <form action="{{ url_for('sample.add_sample_pcf') }}" method="POST">
                {{ form.csrf_token }}
                {{ form_field(form.barcode) }}

                {{ form_field(form.form_select) }}

                {{ form_field(form.collection_date) }}
                {{ form_field(form.disposal_instruction) }}
                {{ form_field(form.disposal_date) }}

                {% if form.donor_select.choices|length > 0 %}
                    {{ form_field(form.has_donor)}}
                    {{ form_field(form.donor_select) }}
                {% endif %}
                
                {{ form_field(form.submit) }}

            </form>
            
        {% else %}
            <div class="row">
                <div class="col">
                    {% if form.form_select.choices|length == 0 %}
                    {{ render_warning(
                    "No Suitable Patient Consent Form Found",
                    [
                        "There are no suitable patient consent form templates found.",
                        "Please add one before adding a sample."
                     ], 'consent.add', "New Patient Consent Form Template", True, True
                ) }}
                        {% else %}
                        {{ render_success(
                        "Patient Consent Forms"
                        ) }}
                        {% endif %}

                </div>
                <div class="col">
                    {% if template_count == 0 %}
                    {{ render_warning(
                    "No Suitable Processing Protocol Found",
                    [
                        "There are no suitable sample processing protocols found.",
                        "Please add one before adding a sample."
                     ], 'processing.new_protocol', "New Sample Processing Protocol", True, True
                ) }}
                        {% else %}
                        {{ render_success(
                        "Processing Protocols"
                        ) }}
                        {% endif %}

                </div>
            </div>


        {% endif %}
    </div>
{% endblock %}

{% block javascript %}
    <script src="{{ url_for('static', filename='js/sample/information/add/step_one.js') }}"></script>
{% endblock %}
