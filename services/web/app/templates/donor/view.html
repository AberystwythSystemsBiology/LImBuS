{% extends "template.html" %}

{% block title %}LIMBDON-{{donor.id}}{% endblock %}

{% block body %}
<div class="container">

        <h1><span class="secondary-heading"><i class="fa fa-user-circle"></i> Donor</span>LIMBDON-{{donor.id}}</h1>

        <div class="row">
            <div class="col-sm-8">
        <div class="btn-toolbar form-group" role="toolbar" aria-label="Toolbar with button groups">
            <div class="btn-group mr-2" role="group" aria-label="First group">
                <a href="{{url_for('donor.edit', donor_id=donor.id) }}">
                    <button type="button" class="btn btn-outline-dark"><i class="fa fa-edit"></i> Edit</button>
                </a>
            </div>
            <div class="btn-group mr-2" role="group" aria-label="First group">
                <button type="button" class="btn btn-outline-dark" disabled><i class="fa fa-lock"></i> Lock</button>
              </div>
            <div class="btn-group" role="group" aria-label="Third group">
              <button type="button" class="btn btn-outline-dark" disabled><i class="fa fa-print"></i> Print</button>
            </div>           
        </div>
        


        <table class="table table-striped">
            
            {{ show_value(donor.age, "Age", "text") }}
            {{ show_value(donor.sex, "Sex", "enum") }}
            {{ show_value(donor.status, "Status", "enum") }}
            {{ show_value(donor.race, "Race", "enum") }}
            {{ show_value(donor.height, "Height (cm)", "text") }}
            {{ show_value(donor.weight, "Weight (kg)", "text") }}
            {{ show_value('%0.2f'| format(donor.weight / (donor.height/100)**2|float), "BMI", "text")}}
            
            {% if donor.status.value == "Deceased" %}
                {{ show_value(donor.death_date, "Death Date", "datetime") }}
            {%endif %}

        </table>
        </div>
        
        <div class="col-sm-4">
            <h3><i class="fas fa-vial"></i> Samples</h3>
        
    </div>
    </div>

    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
        <h3><i class="fa fa-history"></i> Change History</h3>
    </div>

    
    <table id="history" class="table table-striped table-bordered" style="width:100%">
        <thead>
        <tr>
            <th width="70%">Change</th>
            <th>Contributor</th>
        </tr>
        </thead>
        <tbody>
        {% for id, change  in donor.versions.items() %}
            <tr>
                <td>
                    <a data-toggle="collapse" href="#_{{id}}_collapse" aria-expanded="true" aria-controls="_{{id}}_collapse">
                        <i class="fa fa-plus-circle"></i> {{change.items()|length}} changes ({{ change.update_date }})
                        </a>
                        <div class="collapse" id="_{{id}}_collapse">
                        <ul>
                        {% for k, v in change.items() if k not in ["updater_id"] %}
                            <li><b>{{ k }}:</b> {{ v|join(' â†’ ') }}</li>
                        {% endfor %}
                        </ul>
                    </div>
                </td>
                <td>{{ change.updater_id.email }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
</div>



{% endblock %}